{
  "oneOf": [
    {
      "$ref": "#/definitions/schemas/component_dependency/schema"
    },
    {
      "$ref": "#/definitions/schemas/component/schema"
    },
    {
      "$ref": "#/definitions/schemas/deployment_target/schema"
    },
    {
      "$ref": "#/definitions/schemas/dns_zone/schema"
    },
    {
      "$ref": "#/definitions/schemas/domain/schema"
    },
    {
      "$ref": "#/definitions/schemas/environment/schema"
    },
    {
      "$ref": "#/definitions/schemas/repository/schema"
    },
    {
      "$ref": "#/definitions/schemas/server/schema"
    },
    {
      "$ref": "#/definitions/schemas/url/schema"
    }
  ],
  "definitions": {
    "schemas": {
      "component_dependency": {
        "path": "component_dependency.schema.yaml",
        "schema": {
          "orm": {
            "singular": "Component Dependency",
            "plural": "Component Dependencies",
            "relations": [
              {
                "local_property": "parent_component",
                "joins": [
                  {
                    "schema": "component.schema.yaml",
                    "local_key": "parent_component_name",
                    "foreign_key": "name",
                    "type": "one"
                  }
                ]
              },
              {
                "local_property": "child_component",
                "joins": [
                  {
                    "schema": "component.schema.yaml",
                    "local_key": "child_component_name",
                    "foreign_key": "name",
                    "type": "one"
                  }
                ]
              }
            ],
            "primary_property": "name"
          },
          "type": "object",
          "properties": {
            "name": {
              "type": "string",
              "expression": "this.parent_component_name + \" \" + this.child_component_name"
            },
            "parent_component_name": {
              "type": "string"
            },
            "child_component_name": {
              "type": "string"
            }
          },
          "additionalProperties": false
        }
      },
      "component": {
        "path": "component.schema.yaml",
        "schema": {
          "orm": {
            "singular": "Component",
            "plural": "Components",
            "relations": [
              {
                "local_property": "repository",
                "joins": [
                  {
                    "schema": "repository.schema.yaml",
                    "local_key": "repository_name",
                    "foreign_key": "name",
                    "type": "one"
                  }
                ]
              },
              {
                "local_property": "depends_on",
                "joins": [
                  {
                    "schema": "component_dependency.schema.yaml",
                    "local_key": "name",
                    "foreign_key": "child_component_name",
                    "type": "many"
                  }
                ]
              },
              {
                "local_property": "depended_on_by",
                "joins": [
                  {
                    "schema": "component_dependency.schema.yaml",
                    "local_key": "name",
                    "foreign_key": "parent_component_name",
                    "type": "many"
                  }
                ]
              },
              {
                "local_property": "child_components",
                "joins": [
                  {
                    "schema": "component_dependency.schema.yaml",
                    "local_key": "name",
                    "foreign_key": "parent_component_name",
                    "type": "many"
                  },
                  {
                    "schema": "component.schema.yaml",
                    "local_key": "child_component_name",
                    "foreign_key": "name",
                    "type": "one"
                  }
                ]
              },
              {
                "local_property": "parent_components",
                "joins": [
                  {
                    "schema": "component_dependency.schema.yaml",
                    "local_key": "name",
                    "foreign_key": "child_component_name",
                    "type": "many"
                  },
                  {
                    "schema": "component.schema.yaml",
                    "local_key": "parent_component_name",
                    "foreign_key": "name",
                    "type": "one"
                  }
                ]
              }
            ],
            "primary_property": "name"
          },
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            },
            "repository_name": {
              "type": "string"
            },
            "repository": {
              "orm": {
                "singular": "Repository",
                "plural": "Repositories",
                "relations": [
                  {
                    "local_property": "components",
                    "joins": [
                      {
                        "schema": "component.schema.yaml",
                        "local_key": "name",
                        "foreign_key": "repository_name",
                        "type": "many"
                      }
                    ]
                  }
                ]
              },
              "type": "object",
              "properties": {
                "name": {
                  "type": "string"
                },
                "type": {
                  "type": "string",
                  "enum": [
                    "git",
                    "subversion",
                    "cvs"
                  ]
                },
                "checkout": {
                  "type": "object",
                  "properties": {
                    "web": {
                      "type": "string",
                      "format": "uri"
                    },
                    "ssh": {
                      "type": "string",
                      "format": "uri"
                    }
                  },
                  "required": [
                    "web"
                  ]
                }
              },
              "required": [
                "name",
                "type",
                "checkout"
              ],
              "additionalProperties": false
            },
            "depends_on": {
              "type": "array",
              "items": {
                "orm": {
                  "singular": "Component Dependency",
                  "plural": "Component Dependencies",
                  "relations": [
                    {
                      "local_property": "parent_component",
                      "joins": [
                        {
                          "schema": "component.schema.yaml",
                          "local_key": "parent_component_name",
                          "foreign_key": "name",
                          "type": "one"
                        }
                      ]
                    },
                    {
                      "local_property": "child_component",
                      "joins": [
                        {
                          "schema": "component.schema.yaml",
                          "local_key": "child_component_name",
                          "foreign_key": "name",
                          "type": "one"
                        }
                      ]
                    }
                  ]
                },
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "expression": "this.parent_component_name + \" \" + this.child_component_name"
                  },
                  "parent_component_name": {
                    "type": "string"
                  },
                  "child_component_name": {
                    "type": "string"
                  }
                },
                "additionalProperties": false
              }
            },
            "depended_on_by": {
              "type": "array",
              "items": {
                "$ref": "#/properties/depends_on/items"
              }
            }
          },
          "required": [
            "name"
          ],
          "additionalProperties": false
        }
      },
      "deployment_target": {
        "path": "deployment_target.schema.yaml",
        "schema": {
          "orm": {
            "singular": "Deployment Target",
            "plural": "Deployment Targets",
            "relations": [
              {
                "local_property": "component",
                "joins": [
                  {
                    "schema": "component.schema.yaml",
                    "local_key": "component_name",
                    "foreign_key": "name",
                    "type": "one"
                  }
                ]
              },
              {
                "local_property": "server",
                "joins": [
                  {
                    "schema": "server.schema.yaml",
                    "local_key": "server_name",
                    "foreign_key": "name",
                    "type": "one"
                  }
                ]
              },
              {
                "local_property": "domain",
                "joins": [
                  {
                    "schema": "domain.schema.yaml",
                    "local_key": "domain_name",
                    "foreign_key": "name",
                    "type": "one"
                  }
                ]
              }
            ],
            "primary_property": "name"
          },
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            },
            "component_name": {
              "type": "string"
            },
            "domain_name": {
              "type": "string"
            },
            "server_name": {
              "type": "string"
            },
            "environment_name": {
              "type": "string"
            },
            "path": {
              "type": "string",
              "default": "/"
            }
          },
          "additionalProperties": false
        }
      },
      "dns_zone": {
        "path": "dns_zone.schema.yaml",
        "schema": {
          "orm": {
            "singular": "DNS Zone",
            "plural": "DNS Zones",
            "primary_property": "name"
          },
          "type": "object",
          "properties": {
            "domain_name": {
              "type": "string"
            },
            "records": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "type": {
                    "type": "string",
                    "enum": [
                      "a",
                      "cname",
                      "txt"
                    ]
                  },
                  "target": {
                    "type": "string"
                  }
                }
              }
            }
          },
          "required": [
            "domain_name"
          ],
          "additionalProperties": false
        }
      },
      "domain": {
        "path": "domain.schema.yaml",
        "schema": {
          "orm": {
            "singular": "Domain",
            "plural": "Domains",
            "primary_property": "name"
          },
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            }
          },
          "additionalProperties": false
        }
      },
      "environment": {
        "path": "environment.schema.yaml",
        "schema": {
          "orm": {
            "singular": "Environment",
            "plural": "Environments",
            "primary_property": "name"
          },
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            }
          },
          "additionalProperties": false
        }
      },
      "repository": {
        "path": "repository.schema.yaml",
        "schema": {
          "orm": {
            "singular": "Repository",
            "plural": "Repositories",
            "relations": [
              {
                "local_property": "components",
                "joins": [
                  {
                    "schema": "component.schema.yaml",
                    "local_key": "name",
                    "foreign_key": "repository_name",
                    "type": "many"
                  }
                ]
              }
            ],
            "primary_property": "name"
          },
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "git",
                "subversion",
                "cvs"
              ]
            },
            "checkout": {
              "type": "object",
              "properties": {
                "web": {
                  "type": "string",
                  "format": "uri"
                },
                "ssh": {
                  "type": "string",
                  "format": "uri"
                }
              },
              "required": [
                "web"
              ]
            }
          },
          "required": [
            "name",
            "type",
            "checkout"
          ],
          "additionalProperties": false
        }
      },
      "server": {
        "path": "server.schema.yaml",
        "schema": {
          "orm": {
            "singular": "Server",
            "plural": "Servers",
            "primary_property": "name"
          },
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            },
            "description": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "phycisal",
                "virtual",
                "cluster"
              ]
            },
            "serves": {
              "type": "array",
              "items": {
                "orm": {
                  "singular": "Deployment Target",
                  "plural": "Deployment Targets",
                  "relations": [
                    {
                      "local_property": "component",
                      "joins": [
                        {
                          "schema": "component.schema.yaml",
                          "local_key": "component_name",
                          "foreign_key": "name",
                          "type": "one"
                        }
                      ]
                    },
                    {
                      "local_property": "server",
                      "joins": [
                        {
                          "schema": "server.schema.yaml",
                          "local_key": "server_name",
                          "foreign_key": "name",
                          "type": "one"
                        }
                      ]
                    },
                    {
                      "local_property": "domain",
                      "joins": [
                        {
                          "schema": "domain.schema.yaml",
                          "local_key": "domain_name",
                          "foreign_key": "name",
                          "type": "one"
                        }
                      ]
                    }
                  ]
                },
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "component_name": {
                    "type": "string"
                  },
                  "domain_name": {
                    "type": "string"
                  },
                  "server_name": {
                    "type": "string"
                  },
                  "environment_name": {
                    "type": "string"
                  },
                  "path": {
                    "type": "string",
                    "default": "/"
                  }
                },
                "additionalProperties": false
              }
            }
          },
          "additionalProperties": false
        }
      },
      "url": {
        "path": "url.schema.yaml",
        "schema": {
          "orm": {
            "singular": "URL",
            "plural": "URLs",
            "primary_property": "url"
          },
          "type": "object",
          "properties": {
            "url": {
              "type": "string",
              "format": "uri"
            }
          },
          "additionalProperties": false
        }
      }
    }
  }
}